
{% extends 'base.html' %}
{% block content %}
<div class="max-w-3xl mx-auto mt-6">
    <h2 class="text-3xl font-bold text-white mb-2">Station d'Import Universelle</h2>
    <p class="text-gray-400 mb-6">Mettez √† jour vos donn√©es en masse via Excel.</p>

    <div class="glass p-8 rounded-xl border border-slate-700">
        
        {% if message %}
        <div class="p-4 mb-6 text-sm rounded-lg font-bold border {% if success %}bg-green-900/50 border-green-500 text-green-300{% else %}bg-red-900/50 border-red-500 text-red-300{% endif %}">
            {{ message }}
        </div>
        {% endif %}

        <form method="post" enctype="multipart/form-data" class="space-y-6">
            {% csrf_token %}
            
            <!-- Choix du Type -->
            <div>
                <label class="block text-sm font-bold text-gray-300 mb-2">1. Que voulez-vous importer ?</label>
                <select name="import_type" id="typeSelector" onchange="updateInstructions()" class="w-full bg-slate-800 border border-slate-600 rounded p-3 text-white focus:border-neon focus:outline-none">
                    <option value="STOCK">üì¶ Stock (Mati√®res Premi√®res)</option>
                    <option value="CRM">ü§ù CRM (Clients & Prospects)</option>
                    <option value="TOOLS">‚öôÔ∏è Outillage (Cylindres & Clich√©s)</option>
                    <option value="PLANNING">üè≠ Planning Production (OF)</option>
                    <option value="CONSO">üíß Consommation (Flexo/H√©lio)</option>
                </select>
            </div>

            <!-- Zone Upload -->
            <div>
                <label class="block text-sm font-bold text-gray-300 mb-2">2. Fichier Excel (.xlsx)</label>
                <div class="border-2 border-dashed border-slate-600 rounded-lg p-8 text-center hover:border-neon transition bg-slate-800/30">
                    <input type="file" name="excel_file" accept=".xlsx, .xls" required
                           class="block w-full text-sm text-slate-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-neon file:text-black hover:file:bg-cyan-400"/>
                </div>
            </div>

            <!-- Instructions Dynamiques -->
            <div class="bg-slate-900/50 p-4 rounded text-sm border border-slate-700">
                <p class="text-neon font-bold mb-2">Colonnes Excel requises (En-t√™tes) :</p>
                <p id="colList" class="font-mono text-gray-300 text-xs leading-relaxed break-words">Select type...</p>
            </div>
            
            <button type="submit" class="w-full bg-gradient-to-r from-cyan-600 to-blue-600 text-white font-bold py-3 px-6 rounded shadow-lg hover:brightness-110 transition transform active:scale-95">
                Lancer l'Importation
            </button>
        </form>
    </div>
</div>

<script>
    const colMap = {
        'STOCK': 'Designation, Categorie (Film/Encre/Colle), Quantite, Unite, Seuil_Min, Prix',
        'CRM': 'Nom, Ville, Telephone, Email, Secteur, Statut (Active/Prospect)',
        'TOOLS': 'Ref_Produit, Type (Cylindre/Cliche), Serial, Tours_Max, Tours_Actuels',
        'PLANNING': 'OF_Numero, Client, Produit, Machine, Date_Debut (JJ/MM/AAAA), Qte_Prevue',
        'CONSO': 'Date, Type (Flexo/Helio), Support, Laize, Bobine_In, Bobine_Out, Metrage, Noir, Magenta, Jaune, Cyan, Dore, Silver, Orange, Blanc, Vernis, Metoxyn, 2080'
    };

    function updateInstructions() {
        const type = document.getElementById('typeSelector').value;
        document.getElementById('colList').innerText = colMap[type];
    }
    // Init
    updateInstructions();
</script>
{% endblock %}
